{% extends "base.html" %}
{% block title %}Clientes · Servicio Técnico{% endblock %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3">
  <div>
    <h1 class="h3 mb-0">Clientes</h1>
    <div class="text-muted small">Tu base de contactos, pero con facha.</div>
  </div>
  <a class="btn btn-primary" href="{% url 'clientes_nuevo' %}">
    <i class="bi bi-person-plus"></i> Nuevo
  </a>
</div>

<form class="row g-2 mb-3" method="get">
  <div class="col-12 col-lg-10">
    <input class="form-control" name="q" value="{{ request.GET.q|default_if_none:'' }}"
           placeholder="Buscar por nombre, teléfono, email, DNI/CUIT…">
  </div>
  <div class="col-12 col-lg-2 d-grid">
    <button class="btn btn-outline-dark" type="submit">
      <i class="bi bi-search"></i> Buscar
    </button>
  </div>
</form>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover mb-0 align-middle table-modern">
      <thead class="table-light">
        <tr>
          <th>Cliente</th>
          <th>DNI/CUIT</th>
          <th>Contacto</th>
          <th>Dirección</th>
          <th class="text-center">Servicios</th>
          <th>Último ingreso</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>

      <tbody>
        {% for c in object_list %}
        <tr>
          <td>
            <div class="d-flex align-items-center gap-2">
              <span class="avatar text-white {% cycle 'bg-primary' 'bg-success' 'bg-danger' 'bg-warning text-dark' 'bg-info text-dark' 'bg-dark' %}">
                {{ c.nombre|default:"?"|first|upper }}{{ c.apellido|default:""|first|upper }}
              </span>

              <div>
                <div class="client-name">{{ c.apellido }}, {{ c.nombre }}</div>
                <div class="text-muted small">
                  ID: {{ c.id }}
                </div>
              </div>
            </div>
          </td>

          <td class="text-muted">
            {{ c.dni_cuit|default:"-" }}
          </td>

          <td>
            <div class="d-flex flex-wrap gap-2">
              <span class="client-chip">
                <i class="bi bi-telephone"></i> {{ c.telefono|default:"-" }}
              </span>
              <span class="client-chip">
                <i class="bi bi-envelope"></i> {{ c.email|default:"-" }}
              </span>
            </div>
          </td>

          <td class="text-muted">
            {{ c.direccion|default:"-" }}
          </td>

          <td class="text-center">
            <a class="badge text-bg-primary text-decoration-none"
               href="{% url 'servicios_list' %}?cliente={{ c.pk }}"
               title="Ver servicios de este cliente">
              {{ c.servicios_count|default:0 }}
            </a>
          </td>

          <td class="text-muted">
            {% if c.ultimo_ingreso %}
              {{ c.ultimo_ingreso|date:"d/m/Y H:i" }}
            {% else %}
              -
            {% endif %}
          </td>

          <td class="text-end">
            <div class="btn-group" role="group" aria-label="Acciones">
              <a class="btn btn-sm btn-outline-primary" href="{% url 'clientes_editar' c.pk %}" title="Editar">
                <i class="bi bi-pencil"></i>
              </a>
              <a class="btn btn-sm btn-outline-danger" href="{% url 'clientes_eliminar' c.pk %}" title="Eliminar">
                <i class="bi bi-trash"></i>
              </a>
            </div>
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="text-center text-muted py-4">
            No hay clientes todavía.
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{% include "core/pagination.html" %}
{% endblock %}
